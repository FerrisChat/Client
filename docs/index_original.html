<!-- This is the original HTML file, non-minified. -->

<!DOCTYPE html>
<html>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

<!-- Disable zooming: -->
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">

<head>
    <title>FerrisChat</title>
    <style>
        html {
            /* Remove touch delay: */
            touch-action: manipulation;
        }

        body {
            /* Background color for what is not covered by the egui canvas,
            or where the egui canvas is translucent. */
            background: #000;
        }

        /* Allow canvas to fill entire web page: */
        html,
        body {
            overflow: hidden;
            margin: 0 !important;
            padding: 0 !important;
        }

        /* Position canvas in center-top: */
        canvas {
            margin-right: auto;
            margin-left: auto;
            display: block;
            position: absolute;
            left: 50%;
            transform: translate(-50%, 0%);
            top: 0%;
            z-index: 2;
        }
        p {
            margin-right: auto;
            margin-left: auto;
            display: block;
            position: absolute;
            left: 50%;
            transform: translate(-50%, 0%);
            z-index: 1;
            color: #FFF;
        }
    </style>
    <link rel="manifest" href="./manifest.json">
    <script>
      // register ServiceWorker
      window.onload = () => {
          'use strict';

          if ('serviceWorker' in navigator) {
              navigator.serviceWorker
                      .register('./sw.js');
          }
      }
    </script>

    <meta name="theme-color" content="#F17036">
    <link rel="apple-touch-icon" href="./icon-192.png">
</head>
	
<body>
    <p>Loading client...<br><br>
    If this takes longer than 15 seconds:<br>
    * Check your internet connection (this can take up to 90 seconds on 2G connections due to a 1MB file being downloaded)<br>
    <span id="browser_detect"></span>
    * Try using the native app<br>
    </p>
    <noscript><p>
        * <b>Enable JavaScript!</b> We only use simple JS to load Rust code that runs fast.
        An analytics script is also installed, but you can deny sending data by enabling Do Not Track.
    </p></noscript>

    <!-- The WASM code will resize this canvas to cover the entire screen -->
    <canvas id="app_canvas"></canvas>

    <script>
        // true means Firefox: https://stackoverflow.com/a/34918134
        // this returns true in Firefox 92, and false in Chromium 94 as of Oct 2021
        let isFirefox = typeof InstallTrigger !== 'undefined';
        if (!isFirefox) {
            // borrowed from StackOverflow: https://stackoverflow.com/a/2401861
            navigator.saysWho = (() => {
                const { userAgent } = navigator
                let match = userAgent.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i) || []
                let temp
                if (/trident/i.test(match[1])) {
                    temp = /\brv[ :]+(\d+)/g.exec(userAgent) || []
                    return `IE ${temp[1] || ''}`
                }
                if (match[1] === 'Chrome') {
                    temp = userAgent.match(/\b(OPR|Edge)\/(\d+)/)
                    if (temp !== null) {
                        return temp.slice(1).join(' ').replace('OPR', 'Opera')
                    }
                    temp = userAgent.match(/\b(Edg)\/(\d+)/)
                    if (temp !== null) {
                        return temp.slice(1).join(' ').replace('Edg', 'Edge (Chromium)')
                    }
                }
                match = match[2] ? [ match[1], match[2] ] : [ navigator.appName, navigator.appVersion, '-?' ]
                temp = userAgent.match(/version\/(\d+)/i)
                if (temp !== null) {
                    match.splice(1, 1, temp[1])
                }
                return match.join(' ')
            })();
            document.getElementById("browser_detect").innerHTML = "* Switch to Firefox 92 or higher (" + navigator.saysWho + " detected)<br>"
        }
    </script>

    <script>
        // The `--no-modules`-generated JS from `wasm-bindgen` attempts to use
        // `WebAssembly.instantiateStreaming` to instantiate the wasm module,
        // but this doesn't work with `file://` urls. This example is frequently
        // viewed by simply opening `index.html` in a browser (with a `file://`
        // url), so it would fail if we were to call this function!
        //
        // Work around this for now by deleting the function to ensure that the
        // `no_modules.js` script doesn't have access to it. You won't need this
        // hack when deploying over HTTP.
        delete WebAssembly.instantiateStreaming;
    </script>

    <!-- This is the JS generated by the `wasm-bindgen` CLI tool -->
    <script src="ferrischat_client.js"></script>

    <script>
        function wasmLoadError(details) {
            alert("An exception happened while trying to load the app. If you're not running Firefox," +
                    " you will not get any support for this issue. If you are running Firefox, you can" +
                    " view the exact error in console (ctrl+shift+i) and report it to our dev team over" +
                    " on GitHub.\nDetails: " + details);
            console.error(details)
        }

        // We'll defer our execution until the wasm is ready to go.
        // Here we tell bindgen the path to the wasm file so it can start
        // initialization and return to us a promise when it's done.
        wasm_bindgen("./ferrischat_client_bg.wasm")
            .then(on_wasm_loaded)["catch"](wasmLoadError);

        function on_wasm_loaded() {
            // This call installs a bunch of callbacks and then returns.
            wasm_bindgen.start("app_canvas");
        }
    </script>
    <script async defer src="https://sa.ferris.chat/latest.js"></script>
    <noscript><img src="https://sa.ferris.chat/noscript.gif" alt="" referrerpolicy="no-referrer-when-downgrade" /></noscript>
</body>

</html>

<!-- Powered by egui: https://github.com/emilk/egui/ -->
